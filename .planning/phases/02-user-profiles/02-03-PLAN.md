---
phase: 02-user-profiles
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/u/[username]/page.tsx
  - src/app/u/[username]/not-found.tsx
  - src/components/profile/ProfileHeader.tsx
  - src/components/profile/ProfileAbout.tsx
  - src/components/profile/ProviderInfo.tsx
  - src/components/profile/PortfolioCarousel.tsx
autonomous: true

must_haves:
  truths:
    - "Public profile page loads at /u/[username] showing user's info"
    - "Profile header displays avatar, display name, username, and member since date"
    - "Profile header shows aggregate rating placeholder (0.0 stars, updates in Phase 6 when reviews exist)"
    - "Bio section shows user's bio text"
    - "Provider sections (skills, experience, certifications) only appear if user isProvider"
    - "Portfolio carousel shows portfolio images in horizontal slider"
    - "Invalid username shows custom 404 page"
    - "View services button appears as CTA on other users' profiles"
  artifacts:
    - path: "src/app/u/[username]/page.tsx"
      provides: "Public profile page with dynamic username route"
    - path: "src/app/u/[username]/not-found.tsx"
      provides: "Custom 404 for invalid usernames"
    - path: "src/components/profile/ProfileHeader.tsx"
      provides: "Avatar, name, stats header component"
    - path: "src/components/profile/ProfileAbout.tsx"
      provides: "Bio section component"
    - path: "src/components/profile/ProviderInfo.tsx"
      provides: "Provider-only info component (skills, experience, certifications)"
    - path: "src/components/profile/PortfolioCarousel.tsx"
      provides: "Swiper-based portfolio image carousel"
  key_links:
    - from: "src/app/u/[username]/page.tsx"
      to: "prisma.user.findUnique"
      via: "username lookup query"
      pattern: "findUnique.*username"
    - from: "src/components/profile/PortfolioCarousel.tsx"
      to: "swiper"
      via: "Swiper component import"
      pattern: "import.*Swiper"
---

<objective>
Build the public profile view page at `/u/[username]` with profile header, about section, conditional provider info, and portfolio image carousel.

Purpose: This is how users discover and evaluate other users/providers. The profile page is the identity layer that shows who someone is, what they offer, and samples of their work. Provider sections only appear when the user has opted into being a provider.
Output: Complete public profile page with all display components and dynamic username routing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-user-profiles/02-CONTEXT.md
@.planning/phases/02-user-profiles/02-RESEARCH.md
@.planning/phases/02-user-profiles/02-01-SUMMARY.md
@prisma/schema.prisma
@src/lib/auth.ts
@src/lib/db.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile display components</name>
  <files>src/components/profile/ProfileHeader.tsx, src/components/profile/ProfileAbout.tsx, src/components/profile/ProviderInfo.tsx, src/components/profile/PortfolioCarousel.tsx</files>
  <action>
**File: `src/components/profile/ProfileHeader.tsx`**

Server component displaying the profile header:
- Large circle avatar (or placeholder with initials if no avatar)
- Display name (large, bold)
- @username below name (gray, smaller)
- Stats row: "Member since [month year]" and if isProvider show "Provider" badge
- Stats row includes aggregate rating placeholder: '★ 0.0 (No reviews yet)' — real rating data comes in Phase 6
- If viewing another user's profile (not your own), show a "View Services" button as primary CTA (orange-600, links to `#` placeholder until Phase 3 gigs exist)
- If viewing own profile, show "Edit Profile" link to `/profile/edit`

Props: `user` object (with relevant fields), `isOwnProfile` boolean

Styling: White card, rounded-lg, shadow-lg, centered avatar overlapping top edge or at left side. Use the warm orange/amber scheme.

**File: `src/components/profile/ProfileAbout.tsx`**

Simple server component:
- Section title "About"
- User's bio text (or "No bio yet" empty state in gray italic)
- Clean typography with proper line spacing

Props: `bio: string | null`

**File: `src/components/profile/ProviderInfo.tsx`**

Server component that ONLY renders if user `isProvider` is true:
- Section title "Provider Details"
- Professional summary in a highlighted card
- Skills displayed as tag/chip badges (rounded-full, orange-100 bg, orange-800 text)
- Years of experience shown clearly
- Certifications listed if any exist
- Provider bio in a separate subsection

Props: `user` object with provider fields. Component returns `null` if `!user.isProvider`.

> **Phase 2 interim:** `isProvider` flag is the visibility condition for provider sections in Phase 2. Phase 3 will refine this to gig-count-based visibility (provider sections appear only when user has created gigs).

**File: `src/components/profile/PortfolioCarousel.tsx`**

Client component using Swiper for portfolio images:
- Import Swiper CSS and modules: Navigation, Pagination
- Horizontal slider with left/right arrows and dot pagination
- Each slide shows the portfolio image (cover fit, rounded corners)
- Optional caption below each image
- Responsive: 1 image on mobile, 2 on tablet, 3 on desktop via `breakpoints`
- If no portfolio images, render nothing (return null)
- Import Swiper styles in the component: `import 'swiper/css'`, `import 'swiper/css/navigation'`, `import 'swiper/css/pagination'`

Props: `images: { id: string; imageUrl: string; caption: string | null }[]`

All components use the warm orange/amber Tailwind classes consistent with existing Phase 1 styling.
  </action>
  <verify>
Run `npx tsc --noEmit` — no TypeScript errors.
Confirm all four component files exist in `src/components/profile/`.
  </verify>
  <done>Four profile display components created: header with avatar/name/stats, about section with bio, conditional provider info with skills/badges, portfolio carousel with Swiper.</done>
</task>

<task type="auto">
  <name>Task 2: Build public profile page with dynamic username route</name>
  <files>src/app/u/[username]/page.tsx, src/app/u/[username]/not-found.tsx</files>
  <action>
**File: `src/app/u/[username]/page.tsx`**

Server component that:
1. Extracts `username` from params (params are async in Next.js 15 — `const { username } = await params`)
2. Queries Prisma for user by username (include portfolioImages ordered by `order` asc)
3. Calls `notFound()` if no user found
4. Gets current session via `auth()` to determine if viewing own profile
5. Renders page layout:

Layout structure (single scrolling page):
```
<div className="min-h-screen bg-gradient-to-br from-orange-50 via-amber-50 to-orange-100">
  <div className="max-w-3xl mx-auto px-6 py-12">
    <ProfileHeader user={user} isOwnProfile={isOwnProfile} />
    <ProfileAbout bio={user.bio} />
    {user.isProvider && <ProviderInfo user={user} />}
    {user.portfolioImages.length > 0 && (
      <PortfolioCarousel images={user.portfolioImages} />
    )}
  </div>
</div>
```

Section ordering (Claude's discretion decision):
1. Header (avatar, name, stats) — always visible
2. About (bio) — always visible
3. Provider info (skills, experience, certifications) — only if isProvider
4. Portfolio carousel — only if has images

Add metadata generation for SEO:
```ts
export async function generateMetadata({ params }: { params: Promise<{ username: string }> }) {
  const { username } = await params;
  const user = await prisma.user.findUnique({ where: { username } });
  if (!user) return { title: "User Not Found" };
  return {
    title: `${user.displayName || user.username} - Herafi`,
    description: user.bio || `${user.displayName || user.username}'s profile on Herafi`,
  };
}
```

**File: `src/app/u/[username]/not-found.tsx`**

Custom 404 page for invalid usernames:
- Centered layout with warm background
- "User not found" heading
- "The profile you're looking for doesn't exist." description
- "Go Home" link button back to `/`
- Consistent styling with the rest of the app
  </action>
  <verify>
1. Run `npx tsc --noEmit` — no errors
2. Run `npm run build` — page builds successfully
3. Create a test user with username via Prisma Studio, navigate to `/u/[username]` — profile displays
4. Navigate to `/u/nonexistent` — shows custom 404
5. View own profile — shows "Edit Profile" link
6. Provider sections hidden when isProvider is false
  </verify>
  <done>Public profile page at /u/[username] renders user info with conditional provider sections, portfolio carousel, and custom 404 for invalid usernames.</done>
</task>

</tasks>

<verification>
1. `/u/[username]` loads for valid usernames, shows 404 for invalid
2. Profile header shows avatar (or placeholder), display name, @username, member since
3. Bio section shows bio text or "No bio yet" empty state
4. Provider info only visible when isProvider is true
5. Portfolio carousel only visible when user has portfolio images
6. "View Services" button appears on other users' profiles
7. "Edit Profile" link appears on own profile
8. No TypeScript errors
</verification>

<success_criteria>
- Public profile page renders at /u/[username] with warm styling
- ProfileHeader shows avatar, name, username, stats
- ProviderInfo conditionally renders only for providers
- PortfolioCarousel displays images in horizontal Swiper slider
- Custom 404 for invalid usernames
- SEO metadata generated per profile
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-profiles/02-03-SUMMARY.md`
</output>
