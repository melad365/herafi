---
phase: 03-service-listings-discovery
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/gigs/page.tsx
  - src/app/browse/[category]/page.tsx
  - src/components/gigs/GigCard.tsx
  - src/components/gigs/GigGrid.tsx
  - src/components/search/SearchBar.tsx
  - src/components/search/CategoryFilter.tsx
  - src/components/search/PriceRangeFilter.tsx
  - src/components/search/FilterPanel.tsx
  - src/components/search/Pagination.tsx
autonomous: true

must_haves:
  truths:
    - "User can browse all gigs at /gigs"
    - "User can browse gigs by category at /browse/[category]"
    - "User can search gigs using keywords in the search bar"
    - "User can filter results by price range"
    - "Search/filter state persists in URL search params (bookmarkable)"
    - "Gig cards show title, first image, category, provider info, and starting price"
    - "Pagination works for large result sets"
  artifacts:
    - path: "src/app/gigs/page.tsx"
      provides: "Main gigs browse/search page"
    - path: "src/app/browse/[category]/page.tsx"
      provides: "Category-specific browse page"
    - path: "src/components/gigs/GigCard.tsx"
      provides: "Gig preview card component"
    - path: "src/components/gigs/GigGrid.tsx"
      provides: "Grid layout for gig cards"
    - path: "src/components/search/SearchBar.tsx"
      provides: "Keyword search input with debounce"
    - path: "src/components/search/FilterPanel.tsx"
      provides: "Combined filter UI (category + price)"
    - path: "src/components/search/Pagination.tsx"
      provides: "Page navigation component"
  key_links:
    - from: "src/app/gigs/page.tsx"
      to: "src/lib/search.ts"
      via: "Calls searchGigs with parsed URL params"
      pattern: "searchGigs"
    - from: "src/components/search/SearchBar.tsx"
      to: "URL"
      via: "Updates ?q= search param via router.replace"
      pattern: "router\\.replace.*params\\.toString"
    - from: "src/components/search/FilterPanel.tsx"
      to: "URL"
      via: "Updates category, minPrice, maxPrice params"
      pattern: "params\\.set.*category|minPrice|maxPrice"
    - from: "src/app/browse/[category]/page.tsx"
      to: "prisma"
      via: "Queries gigs filtered by category"
      pattern: "prisma\\.gig\\.findMany.*category"
---

<objective>
Build the browse and search experience — the main gigs listing page with search/filter, category browse pages, and all the UI components for displaying and navigating gig results.

Purpose: This is the discovery side of the marketplace. Users need to find services through browsing, searching, and filtering. URL-based state makes results bookmarkable and shareable.
Output: Browse/search pages, gig card/grid components, search bar, filter panel, pagination.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-service-listings-discovery/03-01-SUMMARY.md
@src/lib/search.ts
@src/lib/db.ts
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gig display components (GigCard, GigGrid, Pagination)</name>
  <files>
    src/components/gigs/GigCard.tsx
    src/components/gigs/GigGrid.tsx
    src/components/search/Pagination.tsx
  </files>
  <action>
**src/components/gigs/GigCard.tsx:**
Server component (no `'use client'`). Displays a single gig preview card.

Props interface — accept gig data with provider info:
```
{
  slug: string; title: string; images: string[]; category: string;
  pricingTiers: any; // JSONB — extract basic.price for "Starting at"
  provider: { username: string; displayName: string | null; avatarUrl: string | null }
}
```

Layout:
- Card with rounded corners, border, overflow-hidden, hover shadow transition.
- Top: aspect-video image area. If gig.images[0] exists, show with next/image (fill, object-cover). Otherwise gray placeholder with "No image" text.
- Below image: category label (uppercase, small text, text-gray-600).
- Title: font-semibold, truncate to 2 lines (line-clamp-2), hover changes to text-orange-600.
- Provider row: small avatar (24x24 rounded-full) + displayName or username.
- Footer: "Starting at" label + basic price in text-lg font-bold text-orange-600.
- Whole card wrapped in `<Link href={/gigs/${slug}}>`.

**src/components/gigs/GigGrid.tsx:**
Server component. Grid layout for gig cards.

Props: `{ gigs: GigCardProps[]; emptyMessage?: string }`.
- If gigs empty, show centered message (default: "No services found").
- Grid layout: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6`.
- Map gigs to `<GigCard>` components.

**src/components/search/Pagination.tsx:**
Client component (`'use client'`).

Props: `{ currentPage: number; totalPages: number }`.
- If totalPages <= 1, render nothing.
- Show Previous / page numbers / Next buttons.
- Use `useSearchParams`, `usePathname`, `useRouter` to update `?page=N` param.
- Previous disabled on page 1, Next disabled on last page.
- Style: flex gap, rounded buttons, active page highlighted with bg-orange-600 text-white.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Components export correctly.</verify>
  <done>GigCard displays gig preview with image, title, category, provider, and price. GigGrid renders responsive grid. Pagination navigates via URL params.</done>
</task>

<task type="auto">
  <name>Task 2: Create search/filter components and browse pages</name>
  <files>
    src/components/search/SearchBar.tsx
    src/components/search/CategoryFilter.tsx
    src/components/search/PriceRangeFilter.tsx
    src/components/search/FilterPanel.tsx
    src/app/gigs/page.tsx
    src/app/browse/[category]/page.tsx
  </files>
  <action>
**Install use-debounce:** `npm install use-debounce` for search input debouncing.

**src/components/search/SearchBar.tsx:**
Client component. Keyword search input.
- Props: `{ defaultValue?: string }`.
- Use `useSearchParams`, `usePathname`, `useRouter` from next/navigation.
- Use `useDebouncedCallback` from `use-debounce` with 300ms delay.
- On input change: update `?q=` param (set if value, delete if empty), delete `?page=` to reset pagination.
- Style: full-width input with search icon (magnifying glass via inline SVG or text), rounded-lg, border, focus ring in orange.

**src/components/search/CategoryFilter.tsx:**
Client component. Category dropdown or chip selector.
- Props: `{ currentCategory?: string }`.
- Use same URL param update pattern as SearchBar.
- Show "All Categories" option + all 13 categories with human-readable labels.
- Use CATEGORY_LABELS mapping (import from shared location or define inline).
- Update `?category=` param on selection. Delete param for "All Categories". Reset page.
- Style: select dropdown with rounded border. Or chip buttons — chips are more visual but select is simpler. Use select dropdown for MVP.

**src/components/search/PriceRangeFilter.tsx:**
Client component. Min/max price inputs.
- Props: `{ minPrice?: number; maxPrice?: number }`.
- Two number inputs: "Min $" and "Max $".
- Debounce updates (500ms) to avoid excessive URL changes.
- Update `?minPrice=` and `?maxPrice=` params. Delete if empty.
- Style: inline flex with two compact number inputs.

**src/components/search/FilterPanel.tsx:**
Client component. Combines SearchBar + CategoryFilter + PriceRangeFilter.
- Props: `{ query?: string; category?: string; minPrice?: number; maxPrice?: number }`.
- Layout: SearchBar on top (full width), then a row with CategoryFilter + PriceRangeFilter below.
- Include a "Clear filters" button that removes all search params.
- Wrapped in Suspense boundary (search params reading requires Suspense in Next.js 15).

**src/app/gigs/page.tsx:**
Server component. Main browse/search page.

```typescript
interface SearchParams {
  q?: string; category?: string; minPrice?: string; maxPrice?: string; page?: string
}
```

- Await `searchParams` (Next.js 15 async pattern).
- Parse params: query, category (validate against Category enum), minPrice/maxPrice (parseInt), page.
- Call `searchGigs(filters, page)` from `@/lib/search.ts`.
- Render: page title "Browse Services", FilterPanel (wrapped in Suspense), GigGrid, Pagination.
- If category param provided, show "Showing: [Category Name]" subtitle.

**src/app/browse/[category]/page.tsx:**
Server component. Category-specific browse page.
- Await `params` to get category slug.
- Convert to uppercase: `category.toUpperCase().replace('-', '_')` (handle URL-friendly format like "car-washing" -> "CAR_WASHING").
- Validate against Category enum values. If invalid, call `notFound()`.
- Query gigs: `prisma.gig.findMany({ where: { category, isActive: true }, include: { provider: { select: { ... } } }, orderBy: { createdAt: 'desc' } })`.
- Render: page title "[Category] Services", GigGrid.
- Add breadcrumb: "Browse > [Category]".
- Include link to main /gigs page for broader search.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors. Visit /gigs — page renders with search bar, filters, and grid (may be empty). Visit /browse/plumbing — shows category page. Visit /gigs?q=test — search param reflected in input. Visit /gigs?category=PLUMBING — filter applied. Visit /browse/invalid — returns 404.
  </verify>
  <done>Users can browse all gigs, search with keywords, filter by category and price range, and browse by specific category. All filter state persists in URL search params. Pagination works for navigation.</done>
</task>

</tasks>

<verification>
1. /gigs page renders with search bar, category filter, price filter, and gig grid
2. Typing in search bar updates ?q= param (debounced)
3. Selecting category updates ?category= param
4. Setting price range updates ?minPrice= and ?maxPrice= params
5. /browse/plumbing shows plumbing gigs with category title
6. /browse/invalid returns 404
7. Pagination controls appear when results exceed 12
8. "Clear filters" resets all params
9. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- Browse page at /gigs with full search/filter/pagination
- Category browse pages at /browse/[category]
- URL search params as single source of truth for filters
- GigCard shows image, title, category, provider, and starting price
- Responsive grid layout (1-4 columns based on screen size)
- Debounced search input
- All components type-check correctly
</success_criteria>

<output>
After completion, create `.planning/phases/03-service-listings-discovery/03-03-SUMMARY.md`
</output>
