---
phase: 03-service-listings-discovery
plan: 04
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified:
  - src/app/gigs/[slug]/page.tsx
  - src/app/gigs/[slug]/not-found.tsx
  - src/components/gigs/GigDetailView.tsx
  - src/components/gigs/PricingTierCard.tsx
  - src/components/gigs/GigImageGallery.tsx
  - src/components/gigs/ProviderCard.tsx
  - src/app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Gig detail page shows full description, images, pricing tiers, provider info"
    - "Gig detail page shows reviews placeholder (wired in Phase 6)"
    - "Pricing tiers display as selectable cards with price, description, delivery days, revisions, and features"
    - "Image gallery allows browsing multiple gig images"
    - "Provider sidebar shows avatar, name, rating placeholder, and link to profile"
    - "Gig owner sees Edit and Delete buttons on their gig detail page"
    - "Dashboard shows provider's gigs with management links"
  artifacts:
    - path: "src/app/gigs/[slug]/page.tsx"
      provides: "Gig detail page"
    - path: "src/app/gigs/[slug]/not-found.tsx"
      provides: "404 page for invalid gig slugs"
    - path: "src/components/gigs/GigDetailView.tsx"
      provides: "Full gig detail layout component"
    - path: "src/components/gigs/PricingTierCard.tsx"
      provides: "Single pricing tier display card"
    - path: "src/components/gigs/GigImageGallery.tsx"
      provides: "Image carousel for gig photos"
    - path: "src/components/gigs/ProviderCard.tsx"
      provides: "Provider info sidebar card"
  key_links:
    - from: "src/app/gigs/[slug]/page.tsx"
      to: "prisma"
      via: "Loads gig by slug with provider data"
      pattern: "prisma\\.gig\\.findUnique.*slug"
    - from: "src/components/gigs/GigDetailView.tsx"
      to: "src/components/gigs/PricingTierCard.tsx"
      via: "Renders pricing tier cards"
      pattern: "<PricingTierCard"
    - from: "src/components/gigs/GigDetailView.tsx"
      to: "src/components/gigs/GigImageGallery.tsx"
      via: "Renders image gallery"
      pattern: "<GigImageGallery"
    - from: "src/components/gigs/GigDetailView.tsx"
      to: "src/components/gigs/ProviderCard.tsx"
      via: "Renders provider sidebar"
      pattern: "<ProviderCard"
    - from: "src/app/gigs/[slug]/page.tsx"
      to: "src/actions/gigs.ts"
      via: "Delete action for gig owner"
      pattern: "deleteGig"
---

<objective>
Build the gig detail page — the centerpiece of the marketplace where users view full gig information, browse images, compare pricing tiers, and see provider details.

Purpose: The detail page is where users make the decision to hire. It must present all gig information clearly: images, description, pricing tiers, and provider credibility. Also updates the dashboard to show provider's gigs.
Output: Gig detail page with image gallery, pricing tier cards, provider sidebar, owner controls, and reviews placeholder. Updated dashboard with gig management.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-service-listings-discovery/03-02-SUMMARY.md
@.planning/phases/03-service-listings-discovery/03-03-SUMMARY.md
@src/actions/gigs.ts
@src/app/dashboard/page.tsx
@src/components/profile/PortfolioCarousel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gig detail components (ImageGallery, PricingTierCard, ProviderCard, DetailView)</name>
  <files>
    src/components/gigs/GigImageGallery.tsx
    src/components/gigs/PricingTierCard.tsx
    src/components/gigs/ProviderCard.tsx
    src/components/gigs/GigDetailView.tsx
  </files>
  <action>
**src/components/gigs/GigImageGallery.tsx:**
Client component. Image carousel for gig photos.
- Props: `{ images: string[]; title: string }`.
- If no images, show placeholder with "No images available" message.
- If single image, show it full-width (no carousel controls).
- If multiple images: use Swiper (already installed from Phase 2 portfolio carousel) with navigation arrows and pagination dots.
- Images displayed at aspect-video ratio with object-cover.
- Reference existing `src/components/profile/PortfolioCarousel.tsx` for Swiper setup pattern.

**src/components/gigs/PricingTierCard.tsx:**
Server component. Displays a single pricing tier.
- Props: `{ tier: PricingTier; highlighted?: boolean }` (import PricingTier from validations/pricing).
- Card layout with:
  - Tier name header (Basic/Standard/Premium)
  - Price in large bold text ($XX)
  - Description
  - Delivery: "X days delivery"
  - Revisions: "X revisions"
  - Features list with checkmark icons
- Highlighted tier (Standard by default) gets orange border and "Popular" badge.
- "Continue" / "Select" button at bottom (non-functional for now — wired in Phase 4 Order Flow). Style as button with appropriate color.

**src/components/gigs/ProviderCard.tsx:**
Server component. Provider info sidebar.
- Props: `{ provider: { id: string; username: string | null; displayName: string | null; avatarUrl: string | null; bio: string | null; createdAt: Date } }`.
- Card with:
  - Avatar (64x64, rounded-full) or initials fallback
  - Display name or username
  - "Member since [month year]" from createdAt
  - Rating: "★ 0.0" placeholder (wired in Phase 6)
  - Short bio excerpt (truncated to 100 chars)
  - "View Profile" link to `/u/[username]`
  - "Contact" button (non-functional — wired in Phase 5)

**src/components/gigs/GigDetailView.tsx:**
Server component. Main detail layout combining all subcomponents.
- Props: full gig data with provider, plus `isOwner: boolean`.
- Two-column layout on desktop (lg:grid-cols-3): main content (2 cols) + sidebar (1 col).
- Main content:
  1. GigImageGallery
  2. Title (text-2xl font-bold)
  3. Category badge (inline, uppercase, bg-orange-100 text-orange-800 rounded-full px-3 py-1)
  4. Full description (whitespace-pre-wrap for line breaks)
  5. Pricing tiers section: horizontal row of PricingTierCards (flex/grid, 1-3 cards depending on how many tiers exist). Highlight Standard tier if it exists.
  6. Reviews section: placeholder with "Reviews" heading and "No reviews yet" message (Phase 6 will populate)
- Sidebar:
  1. ProviderCard
  2. If isOwner: "Edit Gig" link button (to /gigs/[slug]/edit) + "Delete Gig" button (red, with confirmation dialog using window.confirm or inline confirm UI). Delete button calls deleteGig server action.
- Mobile: stack vertically (sidebar appears after main content).
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. All 4 components exist with correct exports.</verify>
  <done>Gig detail components render image gallery (Swiper), pricing tier cards with features, provider sidebar with profile link, and full description. Owner controls available for edit/delete.</done>
</task>

<task type="auto">
  <name>Task 2: Create gig detail page, 404 page, and update dashboard</name>
  <files>
    src/app/gigs/[slug]/page.tsx
    src/app/gigs/[slug]/not-found.tsx
    src/app/dashboard/page.tsx
  </files>
  <action>
**src/app/gigs/[slug]/page.tsx:**
Server component. Gig detail page.
- Await `params` to get slug (Next.js 15 async params pattern).
- Query gig: `prisma.gig.findUnique({ where: { slug, isActive: true }, include: { provider: { select: id, username, displayName, avatarUrl, bio, createdAt } } })`.
- If not found, call `notFound()`.
- Check auth (optional — don't redirect, just check): if logged in and gig.providerId === session.user.id, set isOwner = true.
- Render `<GigDetailView gig={gig} isOwner={isOwner} />`.
- Add Next.js metadata: `generateMetadata` function returning `{ title: gig.title, description: gig.description.slice(0, 160) }`.

**src/app/gigs/[slug]/not-found.tsx:**
Simple 404 page for invalid gig slugs.
- Message: "Gig not found"
- Description: "This service listing doesn't exist or has been removed."
- Link back to /gigs: "Browse Services"

**src/app/dashboard/page.tsx:**
Update existing dashboard to show provider's gigs.
- Read the existing dashboard page first to understand current structure.
- Add a "My Gigs" section for providers:
  - Query `prisma.gig.findMany({ where: { providerId: session.user.id }, orderBy: { createdAt: 'desc' }, take: 6 })`.
  - Show gig cards in a grid (reuse GigCard or simpler list with title, category, status, edit link).
  - Include "Create New Gig" button linking to /gigs/new.
  - Show gig count: "X gigs" in section header.
  - Each gig row: title, category badge, "Starting at $X", Edit link, status (active/inactive).
- Keep existing dashboard content (profile card, provider setup card) — just add the gigs section below for providers.
  </action>
  <verify>
Visit /gigs/[valid-slug] — detail page shows full gig info with images, tiers, provider card.
Visit /gigs/invalid-slug — shows 404 page.
Visit /dashboard as provider — shows "My Gigs" section with gig list and "Create New Gig" button.
Visit /gigs/[own-slug] — shows Edit and Delete buttons.
Visit /gigs/[other-slug] — no Edit/Delete buttons visible.
Run `npx tsc --noEmit` — passes.
  </verify>
  <done>Gig detail page displays complete gig information with image gallery, pricing tiers, provider sidebar, and owner controls. 404 page handles invalid slugs. Dashboard shows provider's gigs with management links.</done>
</task>

</tasks>

<verification>
1. /gigs/[slug] shows full gig detail: images, description, pricing tiers, provider info
2. Pricing tiers display correctly (1-3 tiers, Standard highlighted)
3. Image gallery works with Swiper for multiple images
4. Provider card shows avatar, name, member since, and View Profile link
5. Owner sees Edit/Delete buttons; non-owners don't
6. Delete button removes gig and redirects
7. /gigs/invalid returns custom 404 page
8. Dashboard shows provider's gigs with management links
9. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- Gig detail page is the complete information hub for a service listing
- All pricing tiers visible with features, delivery, revisions
- Image gallery navigable via Swiper carousel
- Provider sidebar links to full profile
- Reviews placeholder present (Phase 6 hook point)
- Owner controls (Edit/Delete) properly gated
- Dashboard updated with gig management for providers
</success_criteria>

<output>
After completion, create `.planning/phases/03-service-listings-discovery/03-04-SUMMARY.md`
</output>
