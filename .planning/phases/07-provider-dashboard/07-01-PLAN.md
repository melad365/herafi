---
phase: 07-provider-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/provider/dashboard/page.tsx
  - src/app/provider/dashboard/_components/GigsTab.tsx
  - src/app/provider/dashboard/_components/OrdersTab.tsx
  - src/components/provider/TabNavigation.tsx
autonomous: true

must_haves:
  truths:
    - "Provider can access /provider/dashboard and see tabbed interface"
    - "Provider can view all their gigs with active/inactive status, pricing, and order counts"
    - "Provider can manage gigs (view, edit links) from the gigs tab"
    - "Provider can view incoming orders grouped by status (pending, active, completed)"
    - "Provider sees aggregate stats (total orders, total earnings) at dashboard top"
    - "Tabs are URL-based (?tab=gigs|orders) and bookmarkable"
  artifacts:
    - path: "src/app/provider/dashboard/page.tsx"
      provides: "Provider dashboard with parallel data fetching and tab routing"
      min_lines: 60
    - path: "src/app/provider/dashboard/_components/GigsTab.tsx"
      provides: "Gig management list with edit/view links and empty state"
      min_lines: 40
    - path: "src/app/provider/dashboard/_components/OrdersTab.tsx"
      provides: "Orders grouped by status using existing OrderCard component"
      min_lines: 40
    - path: "src/components/provider/TabNavigation.tsx"
      provides: "Client-side tab navigation with URL search params"
      min_lines: 20
  key_links:
    - from: "src/app/provider/dashboard/page.tsx"
      to: "prisma"
      via: "Promise.all parallel queries for gigs, orders, stats"
      pattern: "Promise\\.all"
    - from: "src/app/provider/dashboard/page.tsx"
      to: "TabNavigation"
      via: "import and render with activeTab prop"
      pattern: "TabNavigation"
    - from: "src/app/provider/dashboard/_components/OrdersTab.tsx"
      to: "OrderCard"
      via: "import with viewAs=provider"
      pattern: "OrderCard.*viewAs.*provider"
---

<objective>
Create the provider dashboard page with tabbed navigation, gig management, and order views.

Purpose: Gives providers a dedicated hub to manage their business - view/edit gigs, track incoming orders with status grouping, and see aggregate business stats. This is the core provider experience.

Output: Provider dashboard at `/provider/dashboard` with URL-based tabs for gigs and orders, parallel data fetching, and aggregate stats header.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-provider-dashboard/07-RESEARCH.md

Key existing files to reference:
@src/app/dashboard/page.tsx (existing buyer-focused dashboard - copy gig rendering pattern)
@src/components/orders/OrderCard.tsx (reuse with viewAs="provider")
@src/components/orders/OrderStatusBadge.tsx (already used by OrderCard)
@src/lib/auth.ts (auth() for session)
@src/lib/db.ts (prisma client)
@src/components/forms/GigForm.tsx (CATEGORY_LABELS export)
@src/lib/validations/pricing.ts (PricingTiers type)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TabNavigation component and provider dashboard page</name>
  <files>
    src/components/provider/TabNavigation.tsx
    src/app/provider/dashboard/page.tsx
  </files>
  <action>
    **TabNavigation component** (`src/components/provider/TabNavigation.tsx`):
    - Client component ('use client') using `useSearchParams` from next/navigation
    - Accept `activeTab` prop (string), default to 'gigs'
    - Render 3 tab links: "My Gigs" (?tab=gigs), "Orders" (?tab=orders), "Messages" (?tab=messages)
    - Active tab gets orange-600 bottom border and text color
    - Inactive tabs: transparent border, gray-600 text, hover:gray-900
    - Wrap in white rounded-lg shadow container with flex gap-6 px-6
    - Use `Link` from next/link with href `/provider/dashboard?tab={id}`
    - Style: `py-4 px-2 border-b-2 font-medium text-sm transition-colors`

    **Provider dashboard page** (`src/app/provider/dashboard/page.tsx`):
    - Server Component (async function)
    - Auth check: `const session = await auth()`, redirect to /login if no session
    - Provider check: Query user.isProvider, redirect to /provider/setup if not provider
    - Read `searchParams` (Next.js 15 async: `const params = await searchParams`)
    - Determine activeTab from `params.tab || 'gigs'`
    - **Parallel data fetching** with Promise.all():
      1. `gigs`: prisma.gig.findMany where providerId = session.user.id, orderBy createdAt desc, include `_count: { select: { orders: true } }`. Select: id, slug, title, category, pricingTiers, isActive, createdAt, _count
      2. `orders`: prisma.order.findMany where providerId = session.user.id, include gig (title, slug) and buyer (username, displayName, avatarUrl), orderBy createdAt desc
      3. `stats`: prisma.order.aggregate where providerId = session.user.id AND status = 'COMPLETED', _count: true, _sum: { totalPrice: true }
    - Layout: min-h-screen bg-gradient-to-br from-orange-50 via-amber-50 to-orange-100
    - max-w-7xl mx-auto px-6 py-12
    - **Stats header**: White rounded-lg shadow-lg p-8 mb-6 with:
      - h1 "Provider Dashboard" text-3xl font-bold
      - Subtitle "Manage your services and orders" text-gray-600
      - Stats row (flex gap-8 mt-4): "Total Orders: {stats._count}" and "Total Earnings: ${stats._sum.totalPrice?.toFixed(2) || '0.00'}" and "Active Gigs: {gigs.filter(g => g.isActive).length}" - each in a small stat card (bg-orange-50 rounded-lg px-4 py-3)
      - "Switch to Buyer Mode" link to /dashboard in top-right corner (text-sm text-gray-600 hover:text-orange-600)
    - Render TabNavigation with activeTab prop
    - Conditional tab content: render GigsTab, OrdersTab, or MessagesTab based on activeTab
    - For MessagesTab (placeholder for Plan 02): render a simple div with "Messages tab coming soon" or import if already exists
    - Type the searchParams as `Promise<{ tab?: string }>` per Next.js 15 pattern
  </action>
  <verify>
    Run `npx tsc --noEmit` - no type errors.
    Visit /provider/dashboard - should show dashboard with stats and tabs.
    Click tabs - URL should change to ?tab=gigs, ?tab=orders, ?tab=messages.
  </verify>
  <done>
    Provider dashboard page renders with stats header, tab navigation, and active tab content. Non-providers redirect to /provider/setup. Tabs update URL search params.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GigsTab and OrdersTab components</name>
  <files>
    src/app/provider/dashboard/_components/GigsTab.tsx
    src/app/provider/dashboard/_components/OrdersTab.tsx
  </files>
  <action>
    **GigsTab** (`src/app/provider/dashboard/_components/GigsTab.tsx`):
    - Server Component (no 'use client')
    - Accept gigs prop typed with: id, slug, title, category, pricingTiers (JsonValue), isActive, _count: { orders: number }
    - Import CATEGORY_LABELS from '@/components/forms/GigForm'
    - Import PricingTiers type from '@/lib/validations/pricing'
    - **Empty state**: If gigs.length === 0, show centered message "You haven't created any gigs yet." with "Create Your First Gig" link to /gigs/new (orange-600 button style)
    - **Gig list**: White rounded-lg shadow-lg p-6
      - Header row: h2 "My Gigs ({gigs.length})" + "Create New Gig" link button (orange-600)
      - Each gig in a flex row with p-4 border rounded-lg hover:border-orange-300:
        - Left: title (font-semibold), active/inactive badge (green-100/gray-100 rounded-full), category label (uppercase), starting price from pricingTiers.basic.price, order count from _count.orders
        - Right: "View" link to /gigs/{slug}, "Edit" link to /gigs/{slug}/edit (orange-100 bg)
    - Pattern: Copy the gig rendering from existing /dashboard/page.tsx but add _count.orders display
    - Cast pricingTiers as PricingTiers for type safety

    **OrdersTab** (`src/app/provider/dashboard/_components/OrdersTab.tsx`):
    - Server Component (no 'use client')
    - Accept orders prop typed to match OrderCard interface with viewAs="provider"
    - Import OrderCard from '@/components/orders/OrderCard'
    - Group orders by status:
      - `pendingOrders`: status === 'PENDING'
      - `activeOrders`: status in ['ACCEPTED', 'IN_PROGRESS']
      - `completedOrders`: status in ['COMPLETED', 'CANCELLED']
    - **Render sections** (each in white rounded-lg shadow-lg p-6):
      1. "Pending Orders ({count})" - if pendingOrders.length > 0, with subtitle "These orders need your attention"
      2. "Active Orders ({count})" - if activeOrders.length > 0
      3. "Completed Orders ({count})" - always shown, with empty message if none
    - Each section renders OrderCard with `viewAs="provider"`
    - For completed, show max 10 with "Showing 10 of {total}" message if more
    - **Global empty state**: If orders.length === 0, show "No orders yet. When customers order your services, they'll appear here."
  </action>
  <verify>
    Run `npx tsc --noEmit` - no type errors.
    Navigate to /provider/dashboard?tab=gigs - gigs listed with edit/view links.
    Navigate to /provider/dashboard?tab=orders - orders grouped by status.
  </verify>
  <done>
    GigsTab shows all provider gigs with management links, active/inactive badges, and order counts. OrdersTab groups orders by pending/active/completed with OrderCard (viewAs="provider"). Both have proper empty states.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. `/provider/dashboard` loads for provider users, redirects non-providers to /provider/setup
3. Stats header shows total orders, earnings, and active gig count
4. Tab navigation works with URL params (?tab=gigs, ?tab=orders)
5. GigsTab shows all gigs with edit/view links
6. OrdersTab shows orders grouped by status using OrderCard
7. Browser back/forward navigates between tabs correctly
</verification>

<success_criteria>
- Provider dashboard accessible at /provider/dashboard with auth + provider checks
- Parallel data fetching with Promise.all() for gigs, orders, and stats
- URL-based tab navigation (gigs, orders) working and bookmarkable
- GigsTab displays all gigs with management links and order counts
- OrdersTab groups orders by status and uses existing OrderCard component
- Aggregate stats visible in dashboard header
</success_criteria>

<output>
After completion, create `.planning/phases/07-provider-dashboard/07-01-SUMMARY.md`
</output>
