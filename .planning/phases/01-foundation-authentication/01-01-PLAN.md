---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - .env.local
  - .env.example
  - .gitignore
  - prisma/schema.prisma
  - src/lib/db.ts
  - src/app/layout.tsx
  - src/app/page.tsx
  - tailwind.config.ts
autonomous: true

must_haves:
  truths:
    - "Next.js 15 app builds and runs without errors"
    - "Prisma schema has User, Account, Session, VerificationToken models"
    - "Database migrations apply successfully"
    - "All auth-related dependencies are installed"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies including next-auth, prisma, bcrypt, zod, react-hook-form"
    - path: "prisma/schema.prisma"
      provides: "Auth.js-compatible database schema with User.hashedPassword field"
      contains: "model User"
    - path: "src/lib/db.ts"
      provides: "Prisma client singleton"
      exports: ["prisma"]
    - path: "src/app/layout.tsx"
      provides: "Root layout with basic structure"
  key_links:
    - from: "src/lib/db.ts"
      to: "prisma/schema.prisma"
      via: "PrismaClient import"
      pattern: "new PrismaClient"
---

<objective>
Initialize the Next.js 15 project with all dependencies, configure Prisma with the Auth.js-compatible database schema, and set up the foundational project structure.

Purpose: Establish the project foundation that all subsequent auth plans depend on. Without this, nothing else can be built.
Output: A running Next.js app with Prisma connected to PostgreSQL, all auth dependencies installed, and the database schema ready.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js project and install all dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    tailwind.config.ts
    .gitignore
    .env.local
    .env.example
    src/app/layout.tsx
    src/app/page.tsx
  </files>
  <action>
    Initialize a new Next.js 15 project in the current directory using `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-npm`. If the directory already has files, answer yes to proceed.

    After initialization, install all auth dependencies:
    ```
    npm install next-auth@beta @auth/prisma-adapter prisma @prisma/client bcrypt zod react-hook-form @hookform/resolvers server-only
    npm install -D @types/bcrypt
    ```

    Create `.env.local` with:
    ```
    DATABASE_URL="postgresql://postgres:postgres@localhost:5432/herafi?schema=public"
    AUTH_SECRET="generate-a-random-secret-here-at-least-32-chars"
    AUTH_URL="http://localhost:3000"
    ```

    Create `.env.example` with the same keys but placeholder values (no secrets):
    ```
    DATABASE_URL="postgresql://user:password@localhost:5432/herafi?schema=public"
    AUTH_SECRET="generate-with-npx-auth-secret"
    AUTH_URL="http://localhost:3000"
    ```

    Ensure `.gitignore` includes `.env.local` and `.env*.local`.

    Update the root `src/app/page.tsx` to show a minimal "Herafi" landing placeholder (just an h1 with "Herafi" and a brief tagline). Remove any default Next.js boilerplate content.

    Update `src/app/layout.tsx` to set the page title to "Herafi" and description to "Services marketplace for in-person and digital work".
  </action>
  <verify>
    Run `npm run build` — should complete without errors.
    Run `npm run dev` in background briefly and confirm the app starts on localhost:3000.
    Confirm all packages are in package.json dependencies.
  </verify>
  <done>
    Next.js 15 app builds successfully. All auth dependencies (next-auth@beta, @auth/prisma-adapter, bcrypt, zod, react-hook-form, @hookform/resolvers, server-only) are installed. Environment files exist with correct structure. Landing page shows "Herafi".
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up Prisma schema with Auth.js models and run migrations</name>
  <files>
    prisma/schema.prisma
    src/lib/db.ts
  </files>
  <action>
    Initialize Prisma: `npx prisma init`

    Replace the generated `prisma/schema.prisma` with the Auth.js-compatible schema. Use PostgreSQL provider. Include these models:

    **User model:**
    - id: String @id @default(cuid())
    - name: String?
    - email: String @unique
    - emailVerified: DateTime?
    - image: String?
    - hashedPassword: String? (for credentials auth)
    - accounts: Account[]
    - sessions: Session[]
    - createdAt: DateTime @default(now())
    - updatedAt: DateTime @updatedAt

    **Account model** (Auth.js standard):
    - id, userId, type, provider, providerAccountId, refresh_token?, access_token?, expires_at?, token_type?, scope?, id_token?, session_state?
    - user relation with onDelete: Cascade
    - @@unique([provider, providerAccountId])

    **Session model** (Auth.js standard):
    - id, sessionToken @unique, userId, expires
    - user relation with onDelete: Cascade

    **VerificationToken model** (Auth.js standard):
    - identifier, token @unique, expires
    - @@unique([identifier, token])

    Create `src/lib/db.ts` with the Prisma client singleton pattern:
    ```typescript
    import { PrismaClient } from "@prisma/client"

    const globalForPrisma = globalThis as unknown as {
      prisma: PrismaClient | undefined
    }

    export const prisma = globalForPrisma.prisma ?? new PrismaClient()

    if (process.env.NODE_ENV !== "production") globalForPrisma.prisma = prisma
    ```

    Run `npx prisma db push` to sync the schema to the database. If the database doesn't exist locally, that's OK — the schema file and client are what matter. The executor should attempt db push but not fail the task if PostgreSQL isn't running locally.

    Run `npx prisma generate` to generate the Prisma client.
  </action>
  <verify>
    Run `npx prisma validate` — schema should be valid.
    Run `npx prisma generate` — should generate client without errors.
    Confirm `src/lib/db.ts` exports `prisma`.
    Run `npm run build` — should still build successfully.
  </verify>
  <done>
    Prisma schema contains User (with hashedPassword), Account, Session, VerificationToken models. Prisma client singleton exists at src/lib/db.ts. Schema validates and client generates successfully. Project still builds.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npx prisma validate` passes
3. All required packages present in package.json
4. `.env.local` and `.env.example` exist with correct keys
5. `src/lib/db.ts` exports prisma client
</verification>

<success_criteria>
- Next.js 15 project initialized with TypeScript, Tailwind, App Router
- All auth dependencies installed (next-auth@beta, @auth/prisma-adapter, bcrypt, zod, react-hook-form, @hookform/resolvers, server-only)
- Prisma schema has all Auth.js models plus hashedPassword on User
- Prisma client singleton created
- Project builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
