---
phase: 09-navigation-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/hooks/useClickOutside.ts
  - src/components/layout/DesktopHamburger.tsx
  - src/components/layout/Header.tsx
autonomous: true

must_haves:
  truths:
    - "User can click hamburger icon next to logo on desktop and see a menu"
    - "Hamburger menu shows grouped sections: Browse (always), Account (logged in), Provider (isProvider)"
    - "Hamburger menu includes Browse Services, Categories, Dashboard, Messages, Orders, My Gigs, Help links"
    - "Hamburger menu auto-closes when user navigates to a new page"
    - "Hamburger menu closes when clicking outside"
    - "Keyboard users can open/close hamburger menu with Enter and Escape"
    - "Header remains a Server Component"
  artifacts:
    - path: "src/components/layout/hooks/useClickOutside.ts"
      provides: "Reusable click-outside detection hook"
      exports: ["useClickOutside"]
    - path: "src/components/layout/DesktopHamburger.tsx"
      provides: "Desktop hamburger menu with grouped navigation sections"
      exports: ["default"]
      min_lines: 80
    - path: "src/components/layout/Header.tsx"
      provides: "Server Component header importing DesktopHamburger"
      contains: "DesktopHamburger"
  key_links:
    - from: "src/components/layout/Header.tsx"
      to: "src/components/layout/DesktopHamburger.tsx"
      via: "import and render with isLoggedIn/isProvider props"
      pattern: "<DesktopHamburger"
    - from: "src/components/layout/DesktopHamburger.tsx"
      to: "src/components/layout/hooks/useClickOutside.ts"
      via: "import useClickOutside hook"
      pattern: "useClickOutside"
    - from: "src/components/layout/DesktopHamburger.tsx"
      to: "next/navigation"
      via: "usePathname for auto-close on navigation"
      pattern: "usePathname"
---

<objective>
Create the desktop hamburger menu with grouped navigation sections and integrate it into the Header.

Purpose: Users need comprehensive navigation access to all key app pages from a single hamburger menu next to the logo, with proper accessibility and auto-close behavior.
Output: useClickOutside hook, DesktopHamburger component, updated Header with hamburger integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-navigation-components/09-RESEARCH.md
@src/components/layout/Header.tsx
@src/components/layout/MobileNav.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useClickOutside hook and DesktopHamburger component</name>
  <files>
    src/components/layout/hooks/useClickOutside.ts
    src/components/layout/DesktopHamburger.tsx
  </files>
  <action>
    **Step 1: Create `src/components/layout/hooks/useClickOutside.ts`**

    Custom hook using useRef and document-level event listener (capturing phase) to detect clicks outside a referenced element. Accept a callback function, return a ref to attach to the container div. Use capturing phase (`true` third arg to addEventListener) for reliable detection. Always clean up listener on unmount.

    **Step 2: Create `src/components/layout/DesktopHamburger.tsx`**

    Client Component ("use client") that receives `isLoggedIn: boolean` and `isProvider: boolean` props.

    Implementation details:
    - Wrap in `className="hidden md:block"` so it only shows on desktop (CSS-only responsive, no JS viewport checks to avoid hydration mismatch)
    - Toggle button with Bars3Icon/XMarkIcon from @heroicons/react/24/outline
    - Use `useClickOutside` hook to close menu when clicking outside
    - Use `usePathname()` + `useEffect` to auto-close menu on navigation (same pattern as MobileNav)
    - Keyboard support: `onKeyDown` handler on toggle button for Escape (close) and Enter/Space (toggle)
    - ARIA attributes: `aria-expanded={isOpen}`, `aria-haspopup="true"`, `aria-label`, `role="menu"` on nav, `role="menuitem"` on links

    Menu content - grouped sections with visual hierarchy:
    1. **Browse** section (always visible): "Browse Services" -> /gigs, "Categories" -> /categories
    2. **Account** section (only if isLoggedIn): "Dashboard" -> /dashboard, "Messages" -> /messages, "Orders" -> /orders
    3. **Provider** section (only if isLoggedIn AND isProvider): "My Gigs" -> /provider/gigs
    4. **Help** section (always visible): "Help" -> /help

    Sections separated by `border-t border-gray-200` dividers with uppercase tracking-wider section headings in `text-xs font-semibold text-gray-500`.

    Menu panel: `fixed inset-x-0 top-16 bg-white border-b border-gray-200 shadow-lg z-40` with inner `max-w-7xl mx-auto px-4 py-6`.

    Each Link gets `onClick={closeMenu}` as backup close mechanism.

    Style menu items: `block px-3 py-2 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors`.

    Follow the existing MobileNav pattern for consistency but with grouped section layout.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors. Visually inspect that the hook exports correctly and DesktopHamburger has proper TypeScript interface.
  </verify>
  <done>
    useClickOutside hook created and exported. DesktopHamburger component renders hamburger button on desktop, shows grouped menu sections, auto-closes on navigation, closes on click outside, supports keyboard navigation with ARIA attributes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate DesktopHamburger into Header</name>
  <files>
    src/components/layout/Header.tsx
  </files>
  <action>
    Modify Header.tsx (Server Component) to import and render DesktopHamburger.

    Changes to Header.tsx:
    1. Add import: `import DesktopHamburger from "./DesktopHamburger";`
    2. Replace the current logo-only left section with a flex container containing logo + DesktopHamburger:
       ```
       <div className="flex items-center gap-2">
         <Link href="/" ...>Herafi</Link>
         <DesktopHamburger isLoggedIn={!!session} isProvider={isProvider} />
       </div>
       ```
    3. Remove the existing desktop nav (`<nav className="hidden md:flex ...">` with the single Browse link) since the hamburger menu now contains Browse Services and all other navigation links.
    4. Keep the desktop auth section (Login/Signup buttons and the avatar circle for logged-in users) intact - Plan 02 will convert the avatar to UserDropdown.
    5. Keep MobileNav unchanged.
    6. Header MUST remain a Server Component (no "use client" directive). Only pass serializable props (boolean, string, null) to DesktopHamburger.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors. Run `npm run build` to verify the app builds successfully with Server/Client component boundary intact.
  </verify>
  <done>
    Header renders DesktopHamburger next to logo. Header remains a Server Component. Desktop shows hamburger icon that opens grouped navigation menu. Existing mobile nav and desktop auth section unaffected.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds (Server/Client boundary intact)
3. DesktopHamburger visible on desktop (hidden on mobile via CSS)
4. Menu shows Browse section for all users, Account section for logged-in users, Provider section for providers
5. Menu closes on Escape key press
6. ARIA attributes present on toggle button and menu
</verification>

<success_criteria>
- Hamburger icon appears next to "Herafi" logo on desktop viewports
- Clicking hamburger opens grouped navigation menu with Browse/Account/Provider/Help sections
- Menu auto-closes on page navigation (usePathname + useEffect)
- Menu closes when clicking outside (useClickOutside hook)
- Keyboard: Enter opens, Escape closes
- Header.tsx has no "use client" directive (remains Server Component)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-navigation-components/09-01-SUMMARY.md`
</output>
