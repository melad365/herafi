---
phase: 09-navigation-components
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/layout/UserDropdown.tsx
  - src/components/layout/Header.tsx
autonomous: true

must_haves:
  truths:
    - "User can click avatar to open dropdown menu"
    - "Dropdown displays username/email and avatar initial"
    - "Dropdown includes Profile, Settings, and Sign Out links"
    - "Dropdown shows provider mode indicator when user is a provider"
    - "Dropdown closes when clicking outside"
    - "Keyboard users can open/close dropdown with Enter and Escape"
    - "Menus render conditionally based on authentication state"
  artifacts:
    - path: "src/components/layout/UserDropdown.tsx"
      provides: "User account dropdown with profile info and navigation"
      exports: ["default"]
      min_lines: 60
    - path: "src/components/layout/Header.tsx"
      provides: "Server Component header with UserDropdown for authenticated users"
      contains: "UserDropdown"
  key_links:
    - from: "src/components/layout/Header.tsx"
      to: "src/components/layout/UserDropdown.tsx"
      via: "import and render with user/isProvider props"
      pattern: "<UserDropdown"
    - from: "src/components/layout/UserDropdown.tsx"
      to: "src/components/layout/hooks/useClickOutside.ts"
      via: "import useClickOutside hook for close-on-outside-click"
      pattern: "useClickOutside"
---

<objective>
Create the user account dropdown menu and integrate it into the Header, replacing the static avatar circle.

Purpose: Authenticated users need quick access to Profile, Settings, and Sign Out from a dropdown triggered by clicking their avatar, with proper accessibility and close-on-outside-click behavior.
Output: UserDropdown component, updated Header with dropdown integration replacing static avatar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-navigation-components/09-RESEARCH.md
@.planning/phases/09-navigation-components/09-01-SUMMARY.md
@src/components/layout/Header.tsx
@src/components/layout/hooks/useClickOutside.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UserDropdown component</name>
  <files>
    src/components/layout/UserDropdown.tsx
  </files>
  <action>
    Create Client Component ("use client") that receives props:
    ```typescript
    interface UserDropdownProps {
      user: {
        name: string | null;
        email: string | null;
        avatar: string; // First letter of name/email, uppercase
      };
      isProvider: boolean;
    }
    ```

    Implementation details:
    - Use `useClickOutside` hook from `./hooks/useClickOutside` for close-on-outside-click
    - Toggle button: avatar circle (w-9 h-9 rounded-full bg-burgundy-100, text-burgundy-900 font-semibold) + ChevronDownIcon that rotates 180deg when open
    - ARIA attributes on button: `aria-expanded={isOpen}`, `aria-haspopup="true"`, `aria-label="User menu"`
    - Keyboard: `onKeyDown` for Escape (close) and Enter/Space (toggle)

    Dropdown panel: `absolute right-0 top-12 w-64 bg-white border border-gray-200 rounded-lg shadow-lg py-2 z-50` with `role="menu"` and `aria-orientation="vertical"`.

    Dropdown content (top to bottom):
    1. **User info header** (px-4 py-3 border-b): Display user.name (or "User" fallback) as `text-sm font-semibold text-gray-900`, user.email as `text-xs text-gray-500 truncate`
    2. **Provider mode indicator** (only if isProvider): `px-4 py-2 border-b bg-burgundy-50` with "Provider Mode Active" in `text-xs font-medium text-burgundy-900`
    3. **Menu items** (py-2): "Profile" -> /profile, "Settings" -> /settings. Each with `role="menuitem"`, `block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors`
    4. **Sign Out** (border-t pt-2): Link to /api/auth/signout in `text-sm text-red-600 hover:bg-red-50`

    Each Link gets `onClick={closeDropdown}` to close menu after clicking.

    Import ChevronDownIcon from `@heroicons/react/24/outline`.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors.
  </verify>
  <done>
    UserDropdown component renders avatar button, opens dropdown with user info header, provider indicator (conditional), Profile/Settings links, and Sign Out. Closes on outside click and Escape key. Has proper ARIA attributes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate UserDropdown into Header</name>
  <files>
    src/components/layout/Header.tsx
  </files>
  <action>
    Modify Header.tsx to replace the static avatar circle and inline navigation links with UserDropdown for authenticated users.

    Changes:
    1. Add import: `import UserDropdown from "./UserDropdown";`
    2. In the desktop auth section (`hidden md:flex items-center gap-4`):
       - Keep the unauthenticated state (Log In + Sign Up links) as-is
       - Replace the entire authenticated state block (Dashboard link, Messages link, Provider Dashboard link, and static avatar div) with a single `<UserDropdown>` component:
         ```tsx
         <UserDropdown
           user={{
             name: session.user?.name ?? null,
             email: session.user?.email ?? null,
             avatar: session.user?.name?.charAt(0).toUpperCase() ?? session.user?.email?.charAt(0).toUpperCase() ?? 'U'
           }}
           isProvider={isProvider}
         />
         ```
    3. Header MUST remain a Server Component. Only pass serializable props (strings, booleans, null).
    4. Do NOT modify MobileNav or DesktopHamburger integrations.

    Note: The Dashboard/Messages/Orders links previously in the desktop auth section are now accessible via the DesktopHamburger menu (Plan 01). The UserDropdown provides Profile, Settings, and Sign Out - a different set of actions.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors. Run `npm run build` to verify the full app builds with all navigation components integrated. Verify Header.tsx has no "use client" directive.
  </verify>
  <done>
    Header renders UserDropdown for authenticated users on desktop. Unauthenticated users see Log In/Sign Up. Header remains a Server Component. All 12 NAV requirements covered across both plans. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. Clicking avatar opens dropdown with user info, Profile, Settings, Sign Out
4. Provider users see "Provider Mode Active" indicator in dropdown
5. Dropdown closes on outside click and Escape key
6. Unauthenticated users see Log In/Sign Up (no dropdown)
7. All NAV-01 through NAV-12 requirements satisfied across Plan 01 + Plan 02
</verification>

<success_criteria>
- Avatar click opens dropdown with username/email display
- Provider mode indicator visible for isProvider users
- Profile, Settings, Sign Out links functional in dropdown
- Dropdown closes on outside click (useClickOutside hook)
- Keyboard: Enter opens, Escape closes
- Header.tsx has no "use client" directive
- Build passes without errors
- Navigation conditional on auth state (dropdown for logged in, buttons for logged out)
</success_criteria>

<output>
After completion, create `.planning/phases/09-navigation-components/09-02-SUMMARY.md`
</output>
